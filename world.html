<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World</title>
  <link rel="stylesheet" href="./style.css?v=world1" />
  <style>
    /* 這頁專用：scene 分成 2/3 戰鬥區 + 1/3 對話框 */
    .gb{
      position: relative;
      padding: 14px;
    }

    .scene{
      height: 100%;
      display: grid;
      grid-template-rows: 2fr 1fr; /* ✅ 2/3 : 1/3 */
      gap: 10px;
    }

    /* 上方戰鬥區 */
    .battle{
      position: relative;
      border: 3px solid var(--gb3);
      box-shadow: inset 0 0 0 2px var(--gb2);
      background: rgba(255,255,255,.12);
      overflow: hidden;
    }

    /* 你想要兩個人物：玩家左下、對手右上 */
    .sprite{
      position: absolute;
      image-rendering: pixelated;
      filter: saturate(.75) contrast(1.05);
      user-select: none;
      pointer-events: none;
    }

    .player{
      left: 10px;
      bottom: 10px; /* ✅ 戰鬥區底部 = 對話框上方，所以自然「踩在框上面」 */
      width: min(38cqw, 180px);
    }

    .rival{
      right: 12px;
      top: 12px;
      width: min(26cqw, 140px);
      opacity: .95;
    }

    /* 簡單 UI 裝飾（可刪） */
    .hpbar{
      position: absolute;
      left: 10px;
      top: 10px;
      width: 45%;
      height: 16px;
      border: 2px solid var(--gb3);
      background: rgba(255,255,255,.25);
    }

    .hpbar2{
      position: absolute;
      right: 10px;
      bottom: 10px;
      width: 38%;
      height: 16px;
      border: 2px solid var(--gb3);
      background: rgba(255,255,255,.18);
    }

    /* 下方對話框：佔整體 1/3（因為 grid rows） */
    .dialog{
      position: relative;
      border: 4px solid var(--gb3);
      box-shadow: inset 0 0 0 3px var(--gb2);
      background: var(--gb0);
      padding: 10px 12px;
      overflow: hidden;
    }

    .dialogText{
      font-weight: 900;
      letter-spacing: .06em;
      line-height: 1.5;
      font-size: 16px;
      white-space: pre-wrap;
      word-break: break-word;
      min-height: 3.2em;
    }

    .nextHint{
      position: absolute;
      right: 10px;
      bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 900;
      letter-spacing: .06em;
      font-size: 12px;
      opacity: .9;
    }

    .blink{
      display: inline-block;
    }
    @keyframes blink { 50%{ opacity:0; } }
  </style>
</head>

<body>
  <div class="page">
    <main class="gb" id="gb">
      <div class="scene" id="scene">
        <!-- 上方戰鬥區 -->
        <section class="battle" id="battle" aria-label="battle">
          <div class="hpbar" aria-hidden="true"></div>
          <div class="hpbar2" aria-hidden="true"></div>

          <!-- ✅ 玩家固定左下（在對話框上面，因為它在 battle 區） -->
         <img class="sprite player" src="./assets/player2.png" alt="player" />

          <!-- ✅ 對手（你可以換成 assets/rival.png 或先用同一張測試） -->
          <img class="sprite rival" src="./assets/player.png" alt="rival" />
        </section>

        <!-- 下方對話框（1/3） -->
        <section class="dialog" id="dialog" aria-label="dialog">
          <div class="dialogText" id="dialogText"></div>

          <div class="nextHint" id="nextHint" style="display:none;">
            <span class="blink">▶</span>
            <span>Enter / 點擊</span>
          </div>
        </section>
      </div>

      <!-- 你原本的掃描線 overlay（如果 style.css 有 .overlay） -->
      <div class="overlay" aria-hidden="true"></div>
    </main>
  </div>

  <script>
    const dialogTextEl = document.getElementById("dialogText");
    const nextHintEl  = document.getElementById("nextHint");
    const dialogEl    = document.getElementById("dialog");

    // 玩家名從 localStorage 讀
    const playerName = (localStorage.getItem("playerName") || "玩家").trim();

    // ✅ 你要的「逐字打字」台詞（自己改內容）
    const lines = [
      `……`,
      `你好，${playerName}。`,
      `準備好了嗎？我們要開始冒險了。`,
      `（按 Enter 或點擊繼續）`
    ];

    let lineIndex = 0;
    let charIndex = 0;
    let typing = false;
    let timer = null;

    function startTypingLine(text){
      clearTimeout(timer);
      typing = true;
      nextHintEl.style.display = "none";
      dialogTextEl.textContent = "";
      charIndex = 0;

      const tick = () => {
        // 一次加 1 個字（你想更快就把 delay 調小）
        dialogTextEl.textContent += text[charIndex];
        charIndex++;

        if (charIndex >= text.length) {
          typing = false;
          nextHintEl.style.display = "flex";
          return;
        }
        timer = setTimeout(tick, 24); // ✅ 打字速度
      };

      tick();
      let didFullscreen = false;

async function tryFullscreen(){
  if (didFullscreen) return;
  didFullscreen = true;

  const el = document.documentElement; // 或 document.getElementById("gb");
  if (!document.fullscreenElement && el.requestFullscreen) {
    try { await el.requestFullscreen(); }
    catch(e){ /* 有些瀏覽器會擋，忽略即可 */ }
  }
    }

    function finishInstant(){
      // 立刻補完這句
      const text = lines[lineIndex] ?? "";
      clearTimeout(timer);
      typing = false;
      dialogTextEl.textContent = text;
      nextHintEl.style.display = "flex";
    }

    function next(){
      tryFullscreen();
      // 還在打字 → 先立刻打完
      if (typing) {
        finishInstant();
        return;
      }

      // 已打完 → 下一句
      lineIndex++;
      if (lineIndex >= lines.length) {
        // ✅ 這裡你可以接下一個場景/選單/進入地圖
        // 例：window.location.assign("map.html");
        nextHintEl.style.display = "none";
        dialogTextEl.textContent = "（劇情結束，接下來可以進地圖）";
        return;
      }

      startTypingLine(lines[lineIndex]);
    }

    // 初始顯示第一句
    startTypingLine(lines[0]);

    // 點擊對話框 or Enter → 下一句
    dialogEl.addEventListener("click", next);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        next();
      }
    });
  </script>
</body>
</html>

